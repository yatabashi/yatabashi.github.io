<!-- TODO:
* 図解
* 参考文献の精選
 -->

# Git基礎編[^0]
Gitの仕組みと基本的な操作について。  
内容の正確性については、その向上に努めてはいるものの、完全ではないことに留意せよ。
その見出し内の情報についての参考になりうべき文献を、見出しにつけた脚注で示している。


## Gitとは[^0-1-2]
Gitは、分散型のバージョン管理システムの一つであるとされる。分散型というのは、バージョン管理を行うリポジトリが中央だけにではなく各端末に存在する（＝各端末がバージョン管理を行う）ものを言う。  

## Gitの導入と初期設定
Gitの利用には、そのインストールと、いくつかの初期設定が必要である。  
まず、Gitをインストールする。Macの場合は次をターミナルから実行する（Homebrewのインストールを前提）。
```
brew install git
```
Windowsの場合は次をPowerShellから実行する（Chocolateyのインストールを前提）。
```
choco install git
```
HomebrewやChocolateyがインストールされていない場合は、次のページを参考にするなどしてインストールすること。
[Homebrewのインストール - Qiita](https://qiita.com/zaburo/items/29fe23c1ceb6056109fd)  
[Windows10環境からChocolateyを使ってGitをインストール - Qiita](https://qiita.com/uroshinse/items/18ec7e88c50e99889d5b)  

次に、Gitで使用するユーザー名とメールアドレスを登録する。これは次のコマンドをターミナルやGit Bashから実行することで可能である。クォーテーション内にそれぞれ希望する文字列を代入すること。
```
git config --global user.name "username"
git config --global user.email "email-address"
```
設定は`~/.gitconfig`に保存されており、次のコマンドで確認できる。
```
cat ~/.gitconfig
```


## Gitの構造[^0-2]
Gitは、実際にファイルを編集する場である「ワークツリー」、後で記録したいファイルの変更内容（差分）を登録しておく「インデックス／ステージ」、端末内でのバージョン管理を行う「（ローカル）リポジトリ」からなる。さらに、複数の端末が接続し得、各ローカルリポジトリのバックアップ・共有・公開のために設置される「リモートリポジトリ」がある場合もある。

### ワークツリー
ワークツリーとは、ユーザーが実際に作業する、ローカル環境にあるディレクトリのことを言う。Gitはこの中で起こるファイルの変更を監視する。

### インデックス／ステージ[^1]
インデックス、あるいはステージとは、次回のコミット（ファイルの変更を（ローカル）リポジトリに記録すること、またその変更内容そのもの）に含ませる変更を登録しておく場所である。ユーザはどの変更内容をインデックスに置く（＝ステージする）かを選択できる。ここで、ファイルの変更とは、ファイルの追加、編集、削除、リネームなどを含む。

### （ローカル）リポジトリ[^2] [^3]
リポジトリとは、ファイルの変更履歴（＝コミット）を記録する場所である。リモートリポジトリが存在する場合は、それと対照してローカルリポジトリと呼ばれる。リポジトリ内では一つ一つのコミットが更新の順序を示す（それぞれどのコミットを元にして（親として）行われた変更であるかがわかる）ようにグラフを成している。

#### コミットのグラフ
コミットのグラフは、コミットの履歴を、コミットをノード、コミットの親子関係をエッジとする（有向）グラフとして表している。グラフは分岐することがある。すなわち、ひとつのコミットを元にして二つ以上のコミットが生まれることがある。  
ところで、グラフのエッジは子から親への一方向である。ここで、エッジの方向は、そのコミットの存在を参照できる方向である。すなわち、親から子は参照できない（子の情報を得るためには、すべてのコミットについて親が自分であるかを確かめる必要がある）。よってグラフの途中で分岐がある場合（一つのコミットを元に複数のコミットを行い、バージョンを分岐させた場合。製品版と開発版など）、一つの枝から別の枝へ辿っていくことができない（少なくとも、容易ではない）。これを解決するのが「ブランチ」である。

#### ブランチ[^3-2] [^4]
ブランチとは、コミットを指定するポインタである。最初のコミットにはmain（またはmaster）という名前のブランチが作成される。あるブランチを元にした新たなコミットがあった場合、そのブランチはそのコミットへと移動する。分岐が生まれそうなときには、予め新たなブランチを作成し、分岐していってしまうことでmainからは見えなくなるコミットを、その新たなブランチから参照することができる。このように、分岐に合わせてブランチを複数設置することによって、一つのリポジトリの中で複数のバージョン管理を並行することができる。  

#### HEAD[^4]
HEADもまたポインタであり、作業中の（現在の作業の元になっている）ブランチを指定する。

### リモートリポジトリ[^7]
リモートリポジトリは、端末ごとのローカルリポジトリで記録されているコミット履歴を共有するために設置されるリポジトリである。一つのリモートリポジトリは複数のローカルリポジトリと対応することができる。  
GitHubは、このリモートリポジトリを提供するサービスである。  


## Gitの操作[^8] [^9]
では、前章で述べた構造を基に、ユーザはGitを実際にどのようにして利用するか。

### 初期化
カレントディレクトリにリポジトリを作成し、ワークツリー内のファイルの変更を監視し始める。
```
git init
```

### ステージング[^10]
次回のコミットに含める変更を選択し、インデックスに登録することを言う。ステージングには`git add`を用いる。
```
git add README.md
```
ところで、インデックスは初回のステージングの際に作成される。

### コミット
その時点でインデックスに載っている変更内容をまとめてリポジトリに記録することを言う。コミットした変更のまとまりのこともコミットと言う。コミットには、そのコミットを説明する「コミットメッセージ」が必要である。
```
git commit -m "commit message"
```
なお、-m以降を省いてコマンドを実行することも可能である。詳細は[Git実用編](./utilise-git.html)を参照のこと。

### ブランチの作成[^10-2]
HEADの位置にブランチを作成するためのコマンドとして、次がある。ここでは、mainというブランチを作成している。
```
git branch main
```
初回のコミット時には、そのコミットを指定するブランチが自動で作成される。

### ブランチの移動
ブランチ間を移動するためのコマンドとして、次がある。ここでは、subというブランチに移動している。より正確に言えば、HEADを、現在指しているブランチから別のブランチに移動させるコマンドである。よって、これを実行することによってワークツリーのファイルの内容が移動先のブランチにおける内容に同期する。
```
git switch sub
```

### リモートリポジトリの作成
リモートリポジトリは、共有サーバや自宅／レンタルサーバに作成したり、GitHubやGitLabなどのサービスを利用して作成するなどする必要がある。ここでは詳説しない。

### プッシュ[^11] [^12]
ローカルリポジトリ内のあるブランチの状態を、リモートリポジトリ内のあるブランチにアップロードする。次のコマンドは、ローカルのmain-lブランチの状態を、リモートのoriginリポジトリ内のmain-rブランチに写す。
```
git push origin main-l:main-r
```
また、ここでリモートリポジトリとして「origin」などとして間接的に指定するためには別途設定が必要である（[Git実用編](./utilise-git.html)より「リモートリポジトリを対応させる」参照）。当該のURLを直接指定することも可能である。  
プッシュ元のブランチとプッシュ先のブランチの名前は同じに設定されることが多い。そのとき、上のコマンドは次のように書くこともできる。ここでは、ブランチの名前をmainとしている。
```
git push origin main
```

## Gitの実用
実際にGitを使っていく上では、これらに加えて幾らかの追加知識があると望ましい。「[Git実用編]()」を参照せよ（未公開）。 <!-- ./utilise-git.md -->  

---
[^0]: [難しいGitコマンドは、仕組みから理解してみよう - Qiita](https://qiita.com/_ha1f/items/2dca1047c57d4f0bd465)  
[^0-1-2]: [MacにGitをインストールする - Qiita](https://qiita.com/suke_masa/items/4bed855628f7414293f8)  
[^0-2]: [Gitではじめるバージョン管理 〜ローカルリポジトリでファイルを管理してみよう〜 - Hivelocity (ハイベロシティ) デジタルでビジネスを最適化](https://prograshi.com/general/git/create-a-new-repository-on-the-command-line/)  
[^1]: [誰得UNIX: ステージを理解して git をもっと便利に使う](http://daretoku-unix.blogspot.com/2009/08/git.html)  
[^2]: [Git の仕組み (1) - こせきの技術日記](https://koseki.hatenablog.com/entry/2014/04/22/inside-git-1)  
[^3]: [Git の仕組み (2) - コミット・ブランチ・タグ - こせきの技術日記](https://koseki.hatenablog.com/entry/2014/06/11/inside-git-2)  
[^3-2]: [ブランチとは｜サル先生のGit入門【プロジェクト管理ツールBacklog】](https://backlog.com/ja/git-tutorial/stepup/01/)  
[^4]: [GitのHEADとは何者なのか - Qiita](https://qiita.com/ymzkjpx/items/00ff664da60c37458aaa)  
[^5]: [Git で「追跡ブランチ」って言うのやめましょう - Qiita](https://qiita.com/uasi/items/69368c17c79e99aaddbf)  
[^6]: [【初心者向け】git fetch、git merge、git pullの違いについて - Qiita](https://qiita.com/wann/items/688bc17460a457104d7d)  
[^7]: [Git用語：上流ブランチとは？ \| WWWクリエイターズ](https://www-creators.com/archives/4931)  
[^8]: [【Git】新人エンジニア、git pushまでの道 - Qiita](https://qiita.com/yukibe/items/9ef9d54f2e7d53cfb51c)  
[^9]: [あなたはまだGitを使いこなせていない - Qiita](https://qiita.com/hitochan/items/32f43181a3e7db342188)  
[^10]: [Gitのインデックスの中身](https://zenn.dev/kaityo256/articles/inside_the_index)  
[^10-2]: [1. ブランチを作成する｜サル先生のGit入門【プロジェクト管理ツールBacklog】](https://backlog.com/ja/git-tutorial/stepup/07/)
[^11]: [【Github】git pushの-uオプションとは何か？上流ブランチやupstreamについて実例で解説｜–set-upstreamとの違いや上流ブランチの確認・設定方法（初心者向け、わかりやすい）](https://prograshi.com/general/git/git-push-u-upstream/)  
[^12]: [git - 違うgitのURLにプロダクトをpushしたい - スタック・オーバーフロー](https://ja.stackoverflow.com/questions/42216/%E9%81%95%E3%81%86git%E3%81%AEurl%E3%81%AB%E3%83%97%E3%83%AD%E3%83%80%E3%82%AF%E3%83%88%E3%82%92push%E3%81%97%E3%81%9F%E3%81%84)  
