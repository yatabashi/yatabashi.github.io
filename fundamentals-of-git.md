# Git基礎

Gitの仕組みと基本的な操作について。  
必ずしも内容が正確ではないことに注意。自分で扱った経験がない、もしくは少ない項目は斜体で表示している。


## Gitとは
Gitは、分散型のバージョン管理システムの一つであるとされる。分散型というのは、バージョン管理を行うリポジトリが中央だけにではなく各端末に存在する（＝各端末がバージョン管理を行う）ものを言う。


## Gitの構造
Gitは、実際にファイルを編集する場である「ワークツリー」、ある時点でのファイルの変更状況を一時保管する「インデックス／ステージ」、端末内でのバージョン管理を行う「（ローカル）リポジトリ」からなる。さらに、複数の端末が接続し得、各ローカルリポジトリのバックアップ・共有・公開のために設置される「リモートリポジトリ」がある場合もある。

### ワークツリー
ワークツリーとは、ユーザーが実際に作業するローカル環境内のディレクトリのことを言う。Gitはこの中で起こるファイルの変更を監視する。

### インデックス／ステージ
インデックス、あるいはステージとは、次回のコミット（ファイルの変更を（ローカル）リポジトリに記録すること）に含まれる差分を登録しておく場所である。ユーザはどの差分をインデックスに置く（＝ステージする）かを選択できる。

http://daretoku-unix.blogspot.com/2009/08/git.html

### （ローカル）リポジトリ
リポジトリとは、ファイルの変更履歴（＝コミット）を記録する場所である。リモートリポジトリが存在する場合は、それと対照してローカルリポジトリと呼ばれる。リポジトリ内では一つ一つのコミットが更新の順序を示す（それぞれどのコミットを元にして行われた変更であるかがわかる）ようにグラフを成している。これをコミットグラフと呼ぶことにする。

#### コミットグラフ 
コミットグラフは、前述の通りコミットの履歴を、コミットをノード、コミットの親子関係をエッジとする（有向）グラフとして表したものである。グラフは分岐することがある。すなわち、ひとつのコミットを元にして二つ以上のコミットが生まれることがある。  
ところで、コミットグラフのエッジは、子から親への一方向である。ここで、エッジの方向は、そのコミットの存在を参照できる方向である。すなわち、親から子は参照できない（その情報を得るためには、すべてのコミットについて親が自身であるかを確かめる必要がある）。この問題を解決するのが、「ブランチ」である。

#### ブランチ
ブランチとは、コミットグラフ内のコミットを指定するポインタである。ブランチが指すコミットからは、そのコミットに応じた親コミット群（グラフを辿ってたどり着けるすべてのコミット）を参照できるので、ブランチごとにそのコミットに至るまでのバージョン変更履歴を管理することができる。ブランチが複数あることによって、一つのリポジトリ内で複数のバージョン管理を並行的に行うことができる。

https://koseki.hatenablog.com/entry/2014/06/11/inside-git-2#6
https://qiita.com/ymzkjpx/items/00ff664da60c37458aaa

#### HEAD
HEADもまたポインタであり、作業中の（現在の作業の元になっている）コミットやブランチを指定するものを言う。HEADは、通常ブランチを指定し、コミットを指定している状態は「detached HEAD」と呼ばれる。この状態でコミットを行っても、それを管理するブランチがないため、そのコミットは利用しにくいことに注意せよ。

https://qiita.com/ymzkjpx/items/00ff664da60c37458aaa

#### *リモート追跡ブランチ*
*後述するリモートリポジトリを設定した場合、ローカルリポジトリ内のブランチにはそれぞれ、リモート追跡ブランチと呼ばれる、リモートリポジトリ内の対応するブランチ（＝上流ブランチ）を追跡する（反映する）ブランチが設定される。リモート追跡ブランチは、変更をリモートリポジトリからローカルリポジトリに取り込む際に利用される。*

https://www-creators.com/archives/4931
https://qiita.com/uasi/items/69368c17c79e99aaddbf
https://qiita.com/wann/items/688bc17460a457104d7d

<!-- ほんとー？ -->
<!-- リモート追跡ブランチの親はいる？ -->

### リモートリポジトリ
リモートリポジトリは、端末ごとのローカルリポジトリで保存されているコミット履歴を共有するために設置されるリポジトリである。リモートリポジトリには、ローカルリポジトリ内の各ブランチに対応する「上流ブランチ」が設定される。  
GitHubは、このリモートリポジトリを提供するサービスである。

https://www-creators.com/archives/4931


## Gitの操作
前章で述べた構造の中で、ユーザはGitをどのようにして利用するか。

### 初期化
カレントディレクトリにリポジトリを作成し、ワークツリー内のファイルの変更を監視し始める。
```
git init
```

<!-- このときインデックスは作成していない？ -->

### ステージング
次回のコミットに含める差分を選択し、インデックスに一時的に保存することを言う。ステージングには`git add`を用いる。
```
git add README.md
```

### コミット
その時点でインデックスに載っている変更をまとめてリポジトリに保存することを言う。コミットした差分のまとまりのこともコミットと言う。
```
git commit
```

### ブランチの作成
HEADの位置にブランチを作成する。次のコマンドでは、mainというブランチを作成している。
```
git branch main
```

https://qiita.com/obonno3/items/f44bb730facc29a3b7d5

### プッシュ
ローカルリポジトリ内のあるブランチを、リモートリポジトリ内のあるブランチとしてアップロードする。次のコマンドは、ローカルのmain-lブランチを、リモートのoriginリポジトリ内のmain-rブランチに写す。
```
git push origin main-l:main-r
```

<!-- ブランチ以外をブランチ以外にプッシュすることはできるか？ -->

https://prograshi.com/general/git/git-push-u-upstream/
https://ja.stackoverflow.com/questions/42216/%E9%81%95%E3%81%86git%E3%81%AEurl%E3%81%AB%E3%83%97%E3%83%AD%E3%83%80%E3%82%AF%E3%83%88%E3%82%92push%E3%81%97%E3%81%9F%E3%81%84

### マージ
あるコミットを元に作業しているワークツリーに、別のコミットでの変更状況を取り込む。注意すべきこととして、あくまで変更を取り込んでくるのであって、それらを統合する訳ではない。典型的には、あるブランチに別のブランチのバージョンを取り込むのに利用される。次のコマンドはsubブランチを取り込む。
```
git merge sub
```

https://qiita.com/uasi/items/69368c17c79e99aaddbf
https://www.sejuku.net/blog/71003

### フェッチ、プル
リモートリポジトリ内のあるブランチを、フェッチはリモート追跡ブランチに、プルは*作業中のワークツリーに、*「マージ」する。次のコマンドは、どちらもリモートのoriginリポジトリ内のmainブランチを「マージ」してきている。フェッチだけでは変更がワークツリーに反映されないことに注意せよ。そのためには別途マージが必要である。
```
git fetch origin main
git pull origin main
```

https://qiita.com/uasi/items/69368c17c79e99aaddbf

<!-- リモート追跡ブランチってリモート（origin）がmasterブランチ、ローカルがmainブランチだったらorigin/master？ -->
<!-- 「作業中のワークツリーに」は本当？非ブランチのコミットへもプルできる？ -->


## Gitの実用
実際にGitを使っていく上では、これらに加えて幾らかの追加知識があると望ましい。「[Gitを実用する](./utilise-git.md)」を参照せよ（未公開）。
