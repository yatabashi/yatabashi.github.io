<!-- TODO:
* 用語の統一：保存、保管、記録など
 -->

# Git基礎[^0]
Gitの仕組みと基本的な操作について。  
必ずしも内容が正確ではないことに注意せよ。自分で扱った経験がない、もしくは少ない項目は斜体で表示している。
その見出し内の情報についての参考文献を、見出しにつけた脚注で示している。


## Gitとは
Gitは、分散型のバージョン管理システムの一つであるとされる。分散型というのは、バージョン管理を行うリポジトリが中央だけにではなく各端末に存在する（＝各端末がバージョン管理を行う）ものを言う。


## Gitの構造[^0-2]
Gitは、実際にファイルを編集する場である「ワークツリー」、後で記録したいファイルの変更内容（差分）を登録しておく「インデックス／ステージ」、端末内でのバージョン管理を行う「（ローカル）リポジトリ」からなる。さらに、複数の端末が接続し得、各ローカルリポジトリのバックアップ・共有・公開のために設置される「リモートリポジトリ」がある場合もある。

### ワークツリー
ワークツリーとは、ユーザーが実際に作業するローカル環境内のディレクトリのことを言う。Gitはこの中で起こるファイルの変更を監視する。

### インデックス／ステージ[^1]
インデックス、あるいはステージとは、次回のコミット（ファイルの変更を（ローカル）リポジトリに記録すること）に含まれる差分を登録しておく場所である。ユーザはどの差分をインデックスに置く（＝ステージする）かを選択できる。

### （ローカル）リポジトリ[^2] [^3]
リポジトリとは、ファイルの変更履歴（＝コミット）を記録する場所である。リモートリポジトリが存在する場合は、それと対照してローカルリポジトリと呼ばれる。リポジトリ内では一つ一つのコミットが更新の順序を示す（それぞれどのコミットを元にして行われた変更であるかがわかる）ようにグラフを成している。

#### コミットのグラフ
コミットのグラフは、前述の通りコミットの履歴を、コミットをノード、コミットの親子関係をエッジとする（有向）グラフとして表したものである。グラフは分岐することがある。すなわち、ひとつのコミットを元にして二つ以上のコミットが生まれることがある。  
ところで、グラフのエッジは子から親への一方向である。ここで、エッジの方向は、そのコミットの存在を参照できる方向である。すなわち、親から子は参照できない（子の情報を得るためには、すべてのコミットについて親が自分であるかを確かめる必要がある）。よってグラフの途中で分岐がある場合（バージョンを分岐させた場合）、一つの枝から別の枝へ辿っていくことができない（少なくとも、容易ではない）。これを解決するのが「ブランチ」である。

#### ブランチ[^3-2] [^4]
ブランチとは、コミットを指定するポインタである。ブランチを元にした新たなコミットがあった場合、ブランチはそのコミットへと移動する。最初のコミットにはmain（またはmaster）という名前のブランチが設定される。一つのコミットから二つ以上のコミットを行う（製品版と開発版、など）ために分岐が生まれそうなときには、予め新たなブランチを設定し、mainから分岐してしまうことでmainからは見えなくなるコミットを、その新たなブランチから参照することができる。  
また、そうしてブランチを複数設置することによって、ブランチごとに異なる変更履歴を持つことができ、一つのリポジトリの中で複数のバージョン管理を並行することができる。

<!-- 図解を追加したら「mainから分岐してしまうことで」は要らない -->

#### HEAD[^4]
HEADもまたポインタであり、作業中の（現在の作業の元になっている）ブランチを指定する。

### リモートリポジトリ[^7]
リモートリポジトリは、端末ごとのローカルリポジトリで保存されているコミット履歴を共有するために設置されるリポジトリである。一つのリモートリポジトリは複数のローカルリポジトリと対応することができる。リモートリポジトリには、ローカルリポジトリ内の特定のブランチに対応する「上流ブランチ」を設定することができる。  
GitHubは、このリモートリポジトリを提供するサービスである。  


## Gitの操作[^8] [^9]
では、前章で述べた構造を基に、ユーザはGitを実際にどのようにして利用するか。

### 初期化
カレントディレクトリにリポジトリを作成し、ワークツリー内のファイルの変更を監視し始める。
```
git init
```

### ステージング[^10]
次回のコミットに含める差分を選択し、インデックスに一時的に保存することを言う。ステージングには`git add`を用いる。
```
git add README.md
```
ところで、インデックスは初回のステージングの際に作成される。

### コミット
その時点でインデックスに載っている変更をまとめてリポジトリに保存することを言う。コミットした差分のまとまりのこともコミットと言う。
```
git commit
```

### ブランチの作成
HEADの位置にブランチを作成するためのコマンドとして、次がある。ここでは、mainというブランチを作成している。
```
git branch main
```
初回のコミット時には、そのコミットを指定するブランチが自動で作成される。

### ブランチの移動
ブランチ間を移動するためのコマンドとして、次がある。ここでは、subというブランチに移動している。より正確に言えば、HEADを、現在指しているブランチから別のブランチに移動させるコマンドである。よって、これを実行することによってワークツリーのファイルの内容が移動先のブランチにおける内容に同期する。
```
git switch sub
```

### プッシュ[^11] [^12]
ローカルリポジトリ内のあるブランチの状態を、リモートリポジトリ内のあるブランチにアップロードする。次のコマンドは、ローカルのmain-lブランチの状態を、リモートのoriginリポジトリ内のmain-rブランチに写す。
```
git push origin main-l:main-r
```

## Gitの実用
実際にGitを使っていく上では、これらに加えて幾らかの追加知識があると望ましい。「[Gitを実用する]()」を参照せよ（未公開）。
<!-- ./utilise-git.md -->


[^0]: [難しいGitコマンドは、仕組みから理解してみよう - Qiita](https://qiita.com/_ha1f/items/2dca1047c57d4f0bd465)  
[^0-2]: [Gitではじめるバージョン管理 〜ローカルリポジトリでファイルを管理してみよう〜 - Hivelocity (ハイベロシティ) デジタルでビジネスを最適化](https://prograshi.com/general/git/create-a-new-repository-on-the-command-line/)  
[^1]: [誰得UNIX: ステージを理解して git をもっと便利に使う](http://daretoku-unix.blogspot.com/2009/08/git.html)  
[^2]: [Git の仕組み (1) - こせきの技術日記](https://koseki.hatenablog.com/entry/2014/04/22/inside-git-1)  
[^3]: [Git の仕組み (2) - コミット・ブランチ・タグ - こせきの技術日記](https://koseki.hatenablog.com/entry/2014/06/11/inside-git-2)  
[^3-2]: [ブランチとは｜サル先生のGit入門【プロジェクト管理ツールBacklog】](https://backlog.com/ja/git-tutorial/stepup/01/)  
[^4]: [GitのHEADとは何者なのか - Qiita](https://qiita.com/ymzkjpx/items/00ff664da60c37458aaa)  
[^5]: [Git で「追跡ブランチ」って言うのやめましょう - Qiita](https://qiita.com/uasi/items/69368c17c79e99aaddbf)  
[^6]: [【初心者向け】git fetch、git merge、git pullの違いについて - Qiita](https://qiita.com/wann/items/688bc17460a457104d7d)  
[^7]: [Git用語：上流ブランチとは？ \| WWWクリエイターズ](https://www-creators.com/archives/4931)  
[^8]: [【Git】新人エンジニア、git pushまでの道 - Qiita](https://qiita.com/yukibe/items/9ef9d54f2e7d53cfb51c)  
[^9]: [あなたはまだGitを使いこなせていない - Qiita](https://qiita.com/hitochan/items/32f43181a3e7db342188)  
[^10]: [Gitのインデックスの中身](https://zenn.dev/kaityo256/articles/inside_the_index)  
[^11]: [【Github】git pushの-uオプションとは何か？上流ブランチやupstreamについて実例で解説｜–set-upstreamとの違いや上流ブランチの確認・設定方法（初心者向け、わかりやすい）](https://prograshi.com/general/git/git-push-u-upstream/)  
[^12]: [git - 違うgitのURLにプロダクトをpushしたい - スタック・オーバーフロー](https://ja.stackoverflow.com/questions/42216/%E9%81%95%E3%81%86git%E3%81%AEurl%E3%81%AB%E3%83%97%E3%83%AD%E3%83%80%E3%82%AF%E3%83%88%E3%82%92push%E3%81%97%E3%81%9F%E3%81%84)  
